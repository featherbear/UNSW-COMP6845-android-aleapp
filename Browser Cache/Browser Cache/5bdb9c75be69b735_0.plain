/*! @name @brightcove/videojs-ima3 @version 3.2.4 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],t):t((e=e||self).videojs,e.window,e.document)}(this,function(e,t,n){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var a="6.6.1";var o=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},r=function(e,t,n){o(0,n),e.trigger({type:t+n.type,originalEvent:n})},i=function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&r(e,"content",t):r(e,"ad",t))},d=function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(o(0,t),e.trigger("resumeended")):r(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(r(e,"content",t),e.trigger("readyforpostroll"))},s=function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())r(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;r(e,"content",t)}},A=function(e,t){e.ads.inAdBreak()?r(e,"ad",t):e.ads.isContentResuming()&&r(e,"content",t)};function u(e){"playing"===e.type?i(this,e):"ended"===e.type?d(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?s(this,e):"play"===e.type?A(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?r(this,"content",e):r(this,"ad",e))}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(e,t){return t?encodeURIComponent(e):e},f=function(e,t,n){if(e&&e[n])for(var a=e[n],o=Object.keys(a),r=0;r<o.length;r++){t["{mediainfo."+n+"."+o[r]+"}"]=a[o[r]]}};var h={processMetadataTracks:function(e,t){for(var n=e.textTracks(),a=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},o=0;o<n.length;o++)a(n[o]);n.addEventListener("addtrack",function(e){a(e.track)})},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},y=function(e,t){return void 0!==t&&e.ads.includedCues[t]},v=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function C(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}h.processAdTrack=function(t,n,a,o){t.ads.includedCues={};for(var r=0;r<n.length;r++){var i=n[r],d=this.getSupportedAdCue(t,i);if(!this.isSupportedAdCue(t,i))return void e.log.warn("Skipping as this is not a supported ad cue.",i);var s=this.getCueId(t,i),A=i.startTime;if(y(t,s))return void e.log("Skipping ad already seen with ID "+s);o&&o(t,d,s,A),a(t,d,s,A),v(t,s)}};var _={},M=e;_.isMiddlewareMediatorSupported=function(){return!M.browser.IS_IOS&&!M.browser.IS_ANDROID&&!!(M.use&&M.middleware&&M.middleware.TERMINATOR)},_.playMiddleware=function(e){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(e.ads&&!0===e.ads._shouldBlockPlay)return e.ads.debug("Using playMiddleware to block content playback"),e.ads._playBlocked=!0,M.middleware.TERMINATOR},play:function(t,n){e.ads&&e.ads._playBlocked&&t?(e.ads.debug("Play call to Tech was terminated."),e.trigger("play"),e.addClass("vjs-has-started"),e.ads._playBlocked=!1):n&&n.catch&&n.catch(function(t){"play() failed because the user didn't interact with the document first. https://goo.gl/xX8pDD"===t.message&&e.trigger("pause")})}}},_.testHook=function(e){M=e};var P=_.playMiddleware,b=_.isMiddlewareMediatorSupported,S=function(){if(e.getPlugin)return Boolean(e.getPlugin("ads"));var t=e.getComponent("Player");return Boolean(t&&t.prototype.ads)};var T=function(){function t(e){c(this,t),this.player=e}return t._getName=function(){return"Anonymous State"},t.prototype.transitionTo=function(e){var t=this.player;this.cleanup(t);var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var a=arguments.length,o=Array(a>1?a-1:0),r=1;r<a;r++)o[r-1]=arguments[r];n.init.apply(n,[t].concat(o))},t.prototype.init=function(){},t.prototype.cleanup=function(){},t.prototype.onPlay=function(){},t.prototype.onPlaying=function(){},t.prototype.onEnded=function(){},t.prototype.onAdEnded=function(){},t.prototype.onAdsReady=function(){e.log.warn("Unexpected adsready event")},t.prototype.onAdsError=function(){},t.prototype.onAdsCanceled=function(){},t.prototype.onAdTimeout=function(){},t.prototype.onAdStarted=function(){},t.prototype.onContentChanged=function(){},t.prototype.onContentResumed=function(){},t.prototype.onReadyForPostroll=function(){e.log.warn("Unexpected readyforpostroll event")},t.prototype.onNoPreroll=function(){},t.prototype.onNoPostroll=function(){},t.prototype.startLinearAdMode=function(){e.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.endLinearAdMode=function(){e.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.skipLinearAdMode=function(){e.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.prototype.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.prototype.isWaitingForAdBreak=function(){return!1},t.prototype.isContentResuming=function(){return!1},t.prototype.inAdBreak=function(){return!1},t.prototype.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},t}(),k=function(e){function t(n){c(this,t);var a=m(this,e.call(this,n));return a.contentResuming=!1,a.waitingForAdBreak=!1,a}return p(t,e),t.prototype.isAdState=function(){return!0},t.prototype.onPlaying=function(){this.contentResuming&&this.transitionTo(j)},t.prototype.onContentResumed=function(){this.contentResuming&&this.transitionTo(j)},t.prototype.isWaitingForAdBreak=function(){return this.waitingForAdBreak},t.prototype.isContentResuming=function(){return this.contentResuming},t.prototype.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(T),w=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t.prototype.isAdState=function(){return!1},t.prototype.onContentChanged=function(e){e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(B):(this.transitionTo(E,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(T),R=void 0;var q={start:function(t){t.ads.debug("Starting ad break"),t.ads._inLinearAdMode=!0,t.trigger("adstart"),t.ads.shouldTakeSnapshots()&&(t.ads.snapshot=function(t){var n=void 0;n=e.browser.IS_IOS&&t.ads.isLive(t)&&t.seekable().length>0?t.currentTime()-t.seekable().end(0):t.currentTime();var a=t.$(".vjs-tech"),o=t.textTracks?t.textTracks():[],r=[],i={ended:t.ended(),currentSrc:t.currentSrc(),sources:t.currentSources(),src:t.tech_.src(),currentTime:n,type:t.currentType()};a&&(i.style=a.getAttribute("style"));for(var d=0;d<o.length;d++){var s=o[d];r.push({track:s,mode:s.mode}),s.mode="disabled"}return i.suppressedTracks=r,i}(t)),t.ads.shouldPlayContentBehindAd(t)&&(t.ads.preAdVolume_=t.volume(),t.volume(0)),t.addClass("vjs-ad-playing"),t.hasClass("vjs-live")&&t.removeClass("vjs-live"),t.ads.removeNativePoster()},end:function(t,n){t.ads.debug("Ending ad break"),void 0===n&&(n=function(){}),t.ads.adType=null,t.ads._inLinearAdMode=!1,t.trigger("adend"),t.removeClass("vjs-ad-playing"),t.ads.isLive(t)&&t.addClass("vjs-live"),t.ads.shouldTakeSnapshots()?function(t,n){var a=t.ads.snapshot;if(void 0===n&&(n=function(){}),!0===t.ads.disableNextSnapshotRestore)return t.ads.disableNextSnapshotRestore=!1,delete t.ads.snapshot,void n();var o=t.$(".vjs-tech"),r=20,i=a.suppressedTracks,d=void 0,s=function(){for(var e=0;e<i.length;e++)(d=i[e]).track.mode=d.mode},A=function(){var n=void 0;if(e.browser.IS_IOS&&t.ads.isLive(t)){if(a.currentTime<0&&(n=t.seekable().length>0?t.seekable().end(0)+a.currentTime:t.currentTime(),t.currentTime(n)),t.paused()){var o=t.play();o&&o.catch&&o.catch(function(t){e.log.warn("Play promise rejected in IOS snapshot resume",t)})}}else if(a.ended)t.currentTime(t.duration());else{t.currentTime(a.currentTime);var r=t.play();r&&r.catch&&r.catch(function(t){e.log.warn("Play promise rejected in snapshot resume",t)})}t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},u=function n(){if(t.off("contentcanplay",n),R&&t.clearTimeout(R),(o=t.el().querySelector(".vjs-tech")).readyState>1)return A();if(void 0===o.seekable)return A();if(o.seekable.length>0)return A();if(r--)t.setTimeout(n,50);else try{A()}catch(t){e.log.warn("Failed to resume the content after an advertisement",t)}};if("style"in a&&o.setAttribute("style",a.style||""),t.ads.videoElementRecycled())t.one("resumeended",function(){delete t.ads.snapshot,n()}),t.one("contentloadedmetadata",s),e.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0),t.src(a.sources),t.one("contentcanplay",u),R=t.setTimeout(u,2e3);else{if(s(),!t.ended()){var l=t.play();l&&l.catch&&l.catch(function(t){e.log.warn("Play promise rejected in snapshot restore",t)})}delete t.ads.snapshot,n()}}(t,n):(t.volume(t.ads.preAdVolume_),n())}},E=function(t){function n(){return c(this,n),m(this,t.apply(this,arguments))}return p(n,t),n._getName=function(){return"Preroll"},n.prototype.init=function(e,t,n){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),n||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var a=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(a=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout(function(){e.trigger("adtimeout")},a),t?this.handleAdsReady():this.adsReady=!1},n.prototype.onAdsReady=function(t){t.ads.inAdBreak()?e.log.warn("Unexpected adsready event (Preroll)"):(t.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},n.prototype.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},n.prototype.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",function(){t.ads.debug("Received loadstart event"),e()}))},n.prototype.noPreroll=function(){var e=this;this.afterLoadStart(function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)})},n.prototype.readyForPreroll=function(){var e=this.player;this.afterLoadStart(function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")})},n.prototype.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart(function(){t.resumeAfterNoPreroll(e)})},n.prototype.onAdsError=function(t){var n=this;e.log("adserror (Preroll)"),this.inAdBreak()?t.ads.endLinearAdMode():this.afterLoadStart(function(){n.resumeAfterNoPreroll(t)})},n.prototype.startLinearAdMode=function(){var t=this.player;!this.adsReady||t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(t.clearTimeout(this._timeout),t.ads.adType="preroll",this.waitingForAdBreak=!1,q.start(t),t.ads._shouldBlockPlay=!1)},n.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},n.prototype.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,q.end(e))},n.prototype.skipLinearAdMode=function(){var t=this,n=this.player;n.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart(function(){n.trigger("adskip"),n.ads.debug("skipLinearAdMode (Preroll)"),t.resumeAfterNoPreroll(n)})},n.prototype.onAdTimeout=function(e){var t=this;this.afterLoadStart(function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)})},n.prototype.onNoPreroll=function(t){t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},n.prototype.resumeAfterNoPreroll=function(e){this.contentResuming=!0,e.ads._shouldBlockPlay=!1,e.paused()&&(e.ads._playRequested||e.ads._pausedOnContentupdate)&&e.play()},n.prototype.cleanup=function(t){t.ads._hasThereBeenALoadStartDuringPlayerLife||e.log.warn("Leaving Preroll state before loadstart event can cause issues."),t.removeClass("vjs-ad-loading"),t.removeClass("vjs-ad-content-resuming"),t.clearTimeout(this._timeout)},n}(k),I=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t._getName=function(){return"Midroll"},t.prototype.init=function(e){e.ads.adType="midroll",q.start(e),e.addClass("vjs-ad-loading")},t.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},t.prototype.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),q.end(e))},t.prototype.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},t.prototype.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(k),L=function(t){function n(){return c(this,n),m(this,t.apply(this,arguments))}return p(n,t),n._getName=function(){return"Postroll"},n.prototype.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_)this.resumeContent(e),this.transitionTo(O);else{e.addClass("vjs-ad-loading");var t=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(t=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout(function(){e.trigger("adtimeout")},t)}},n.prototype.startLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(t.ads.adType="postroll",t.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,q.start(t))},n.prototype.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},n.prototype.endLinearAdMode=function(){var e=this,t=this.player;this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),q.end(t,function(){e.transitionTo(O)}))},n.prototype.skipLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected skipLinearAdMode invocation"):(t.ads.debug("Postroll abort (skipLinearAdMode)"),t.trigger("adskip"),this.abort(t))},n.prototype.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},n.prototype.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},n.prototype.onContentChanged=function(e){this.isContentResuming()?this.transitionTo(B):this.inAdBreak()||this.transitionTo(E)},n.prototype.onNoPostroll=function(t){this.isContentResuming()||this.inAdBreak()?e.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(t)},n.prototype.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},n.prototype.abort=function(e){this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(O)},n.prototype.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},n}(k),B=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t._getName=function(){return"BeforePreroll"},t.prototype.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!0},t.prototype.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},t.prototype.onPlay=function(e){e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(E,this.adsReady,this.shouldResumeToContent)},t.prototype.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},t.prototype.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},t.prototype.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},t.prototype.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},t.prototype.onContentChanged=function(){this.init(this.player)},t}(w),j=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t._getName=function(){return"ContentPlayback"},t.prototype.init=function(e){e.ads._shouldBlockPlay=!1},t.prototype.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},t.prototype.onReadyForPostroll=function(e){e.ads.debug("Received readyforpostroll event"),this.transitionTo(L)},t.prototype.startLinearAdMode=function(){this.transitionTo(I)},t}(w),O=function(t){function n(){return c(this,n),m(this,t.apply(this,arguments))}return p(n,t),n._getName=function(){return"AdsDone"},n.prototype.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},n.prototype.startLinearAdMode=function(){e.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},n}(w),N=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t._getName=function(){return"StitchedAdRoll"},t.prototype.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",q.start(this.player)},t.prototype.onPlaying=function(){},t.prototype.onContentResumed=function(){},t.prototype.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},t.prototype.endLinearAdMode=function(){q.end(this.player),this.transitionTo(U)},t}(k),U=function(e){function t(){return c(this,t),m(this,e.apply(this,arguments))}return p(t,e),t._getName=function(){return"StitchedContentPlayback"},t.prototype.init=function(){this.player.ads._shouldBlockPlay=!1},t.prototype.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this._getName()+")")},t.prototype.startLinearAdMode=function(){this.transitionTo(N)},t}(w),x=_.isMiddlewareMediatorSupported,V=e.getTech("Html5").Events,D={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0},F=function(o){var r=this,i=e.mergeOptions(D,o),d=V.concat(["firstplay","loadedalldata","playing"]);r.on(d,u),x()||function(t,n){n&&e.log("Using cancelContentPlay to block content playback"),t.on("play",C)}(r,i.debug),r.setTimeout(function(){r.ads._hasThereBeenALoadStartDuringPlayerLife||""===r.src()||e.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")},5e3),r.on("ended",function(){r.hasClass("vjs-has-started")||r.addClass("vjs-has-started")}),r.on("contenttimeupdate",function(){r.removeClass("vjs-waiting")}),r.on(["addurationchange","adcanplay"],function(){if((!r.ads.snapshot||r.currentSrc()!==r.ads.snapshot.currentSrc)&&r.ads.inAdBreak()){var t=r.play();t&&t.catch&&t.catch(function(t){e.log.warn("Play promise rejected when playing ad",t)})}}),r.on("nopreroll",function(){r.ads.debug("Received nopreroll event"),r.ads.nopreroll_=!0}),r.on("nopostroll",function(){r.ads.debug("Received nopostroll event"),r.ads.nopostroll_=!0}),r.on("playing",function(){r.ads._cancelledPlay=!1,r.ads._pausedOnContentupdate=!1}),r.on("play",function(){r.ads._playRequested=!0}),r.one("loadstart",function(){r.ads._hasThereBeenALoadStartDuringPlayerLife=!0}),r.on("loadeddata",function(){r.ads._hasThereBeenALoadedData=!0}),r.on("loadedmetadata",function(){r.ads._hasThereBeenALoadedMetaData=!0}),r.ads=function(t){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:a,reset:function(){t.ads.disableNextSnapshotRestore=!1,t.ads._contentEnding=!1,t.ads._contentHasEnded=!1,t.ads.snapshot=null,t.ads.adType=null,t.ads._hasThereBeenALoadedData=!1,t.ads._hasThereBeenALoadedMetaData=!1,t.ads._cancelledPlay=!1,t.ads._shouldBlockPlay=!1,t.ads._playBlocked=!1,t.ads.nopreroll_=!1,t.ads.nopostroll_=!1,t.ads._playRequested=!1},startLinearAdMode:function(){t.ads._state.startLinearAdMode()},endLinearAdMode:function(){t.ads._state.endLinearAdMode()},skipLinearAdMode:function(){t.ads._state.skipLinearAdMode()},stitchedAds:function(t){return void 0!==t&&(e.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!t),this.settings.stitchedAds},videoElementRecycled:function(){if(t.ads.shouldPlayContentBehindAd(t))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=t.tech_.src()!==this.snapshot.src,n=t.currentSrc()!==this.snapshot.currentSrc;return e||n},isLive:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return"boolean"==typeof n.ads.settings.contentIsLive?n.ads.settings.contentIsLive:n.duration()===1/0||"8"===e.browser.IOS_VERSION&&0===n.duration()},shouldPlayContentBehindAd:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;if(n)return!!n.ads.settings.liveCuePoints&&!e.browser.IS_IOS&&!e.browser.IS_ANDROID&&n.duration()===1/0;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return!this.shouldPlayContentBehindAd(e)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var e=t.$(".vjs-tech");e&&e.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];1===n.length&&"string"==typeof n[0]?e.log("ADS: "+n[0]):e.log.apply(e,["ADS:"].concat(n))}}}}(r),r.ads.settings=i,i.stitchedAds=!!i.stitchedAds,i.stitchedAds?r.ads._state=new U(r):r.ads._state=new B(r),r.ads._state.init(r),r.ads.cueTextTracks=h,r.ads.adMacroReplacement=function(a,o,r){var i=this,d={};a=a.replace(/{([^}=]+)=([^}]+)}/g,function(e,t,n){return d["{"+t+"}"]=n,"{"+t+"}"}),void 0===o&&(o=!1);var s={};for(var A in void 0!==r&&(s=r),s["{player.id}"]=this.options_["data-player"],s["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",s["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",s["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",s["{player.duration}"]=this.duration(),s["{timestamp}"]=(new Date).getTime(),s["{document.referrer}"]=n.referrer,s["{window.location.href}"]=t.location.href,s["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach(function(e){i.mediainfo&&i.mediainfo[e]?s["{mediainfo."+e+"}"]=i.mediainfo[e]:d["{mediainfo."+e+"}"]?s["{mediainfo."+e+"}"]=d["{mediainfo."+e+"}"]:s["{mediainfo."+e+"}"]=""}),f(this.mediainfo,s,"custom_fields"),f(this.mediainfo,s,"customFields"),s)a=a.split(A).join(g(s[A],o));for(var u in a=a.replace(/{pageVariable\.([^}]+)}/g,function(n,a){for(var r=void 0,i=t,s=a.split("."),A=0;A<s.length;A++)A===s.length-1?r=i[s[A]]:i=i[s[A]];var u=void 0===r?"undefined":l(r);return null===r?"null":void 0===r?d["{pageVariable."+a+"}"]?d["{pageVariable."+a+"}"]:(e.log.warn('Page variable "'+a+'" not found'),""):"string"!==u&&"number"!==u&&"boolean"!==u?(e.log.warn('Page variable "'+a+'" is not a supported type'),""):g(String(r),o)}),d)a=a.replace(u,d[u]);return a}.bind(r),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}})}(r),r.on("contentchanged",r.ads.reset);var s=function(){var t=r.textTracks();if(!r.ads.shouldPlayContentBehindAd(r)&&r.ads.inAdBreak()&&r.tech_.featuresNativeTextTracks&&e.browser.IS_IOS&&!Array.isArray(r.textTracks()))for(var n=0;n<t.length;n++){var a=t[n];"showing"===a.mode&&(a.mode="disabled")}};r.ready(function(){r.textTracks().addEventListener("change",s)}),r.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],function(e){r.ads._state.handleEvent(e.type)}),r.on("dispose",function(){r.ads.reset(),r.textTracks().removeEventListener("change",s)})};F.VERSION=a,function(t){!S(e)&&((e.registerPlugin||e.plugin)("ads",t),b()&&!e.usingContribAdsMiddleware_&&(e.use("*",P),e.usingContribAdsMiddleware_=!0,e.log("Play middleware has been registered with videojs")))}(F);var H;(e.registerPlugin||e.plugin)("contribAds6Shim",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this,a=void 0,o=void 0,r=0,i=!1;this.contribAds6Shim={VERSION:"1.0.1"},n.ads.state=a=o="content-set",Object.defineProperty(n.ads,"state",{get:function(){return(!0===t.warnOnGetState||"number"==typeof t.warnOnGetState&&r<t.warnOnGetState)&&(e.log.warn("player.ads.state is deprecated. Please use the public methods provided by videojs-contrib-ads 6 instead: https://github.com/videojs/videojs-contrib-ads#public-methods"),r++),t.stateUsageEvent&&!i&&(n.trigger({type:"usage",name:"contrib-ads-state-access"}),i=!0),o},set:function(n){n!==o&&(a=o,o=n,t.debug&&e.log("CA6Shim: "+a+" -> "+o))}}),n.on("contentchanged",function(){n.paused()?n.ads.state="content-set":n.ads.state="ads-ready?"}),n.on("play",function(){"content-set"===o?n.ads.state="ads-ready?":"ads-ready"===o&&(n.ads.state="preroll?")}),n.on("adsready",function(){"content-set"===o?n.ads.state="ads-ready":"ads-ready?"===o&&(n.ads.state="preroll?")}),n.on(["adserror","adtimeout","adskip"],function(){"ads-ready?"!==o&&"preroll?"!==o||(n.ads.state="content-playback")}),n.on("adstart",function(){n.ads.state="ad-playback"}),n.on("adend",function(){n.ads.state="content-resuming"}),n.on("playing",function(){"content-playback"!==o&&(n.trigger("contentplayback"),t.debug&&e.log("CA6Shim: Triggered contentplayback")),n.ads.state="content-playback"}),n.on("contentended",function(){"content-playback"===o&&(n.ads.state="postroll?")}),n.on("ended",function(){n.ads.state="content-playback"})});var z=function(e,t){var n=t.cues,a=t.label,o=t.inBandMetadataTrackDispatchType,r=t.kind;if("metadata"===r)return"media-cues"===a||(!(!o||"metadata"!==r)||(!n||!n.length||e.ima3.cueState_.cueModule.isSupportedAdCue(e,n[0])))},G=function(t,n,a,o,r){0===o&&t.ima3.cueState_.prerollPlayed||r<=1&&t.ima3.cueState_.postrollPlayed||(!function(t,n,a){var o,r=Math.abs(a-t.duration()),i=Math.abs(a-t.currentTime());if(0===a){if(t.ima3.cueState_.prerollPlayed)return;t.ima3.cueState_.prerollPlayed=!0,t.ads.adType="preroll"}if(r<=1){if(t.ima3.cueState_.postrollPlayed)return;t.ima3.cueState_.postrollPlayed=!0}i>=1||(o=!t.ima3.settings.useMediaCuePoints&&n.serverUrl?n.serverUrl:t.ima3.settings.serverUrl,o=t.ima3.adMacroReplacement(o),n.duration&&(/\?/.test(o)?o+="&breaklength="+n.duration:o+="?breaklength="+n.duration),t.ima3.isReady_&&(e.log("Oncue ad request at "+a+" seconds"),t.ima3.adrequest(o)))}(t,n,o),t.ima3.cueState_.usedActiveCues[a]=!0)},Q=function(e,t,n,a,o){0===a&&0===e.currentTime()&&(e.ima3.cueState_.prerollPlayed||e.ima3.cueState_.prerollHandledEarly||(e.paused()&&!e.ads._playRequested?(e.ima3.cueState_.prerollHandledEarly=!0,e.ima3.oneUnlessContentUpdate_("play",function(){G(e,t,n,a,o)})):e.ads.isInAdMode()&&!e.ads.isContentResuming()&&e.ads._playRequested&&G(e,t,n,a,o)))},W=function(e){return e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration()},Y=function(t,n,a,o){var r,i=W(t),d=Math.abs(o-i);t.ads.isAdPlaying()&&((r=n)&&r.text&&"ad"===r.text.toLowerCase()||r&&r.name&&"adcue"===r.name.toLowerCase())||(a?t.ima3.cueState_.usedActiveCues[a]||n.name&&"adcancel"===n.name.toLowerCase()||(0===o?Q(t,n,a,o,d):d<=1&&!t.ima3.cueState_.postrollHandled?(t.ima3.cueState_.postrollHandled=!0,t.ima3.oneUnlessContentUpdate_("contentended",function(){G(t,n,a,o,d)})):t.ima3.isReady_&&!t.ads.isInAdMode()&&G(t,n,a,o,d)):e.log.error("The cue does not have an ID and cannot be used",n))},X=function(t,n,a,o){t.ima3.settings.useMediaCuePoints||"adCancel"!==n.name||!t.ima3.adsManager||t.ima3.cueState_.usedActiveCues[a]||(t.ima3.cueState_.usedActiveCues[a]=!0,t.ima3.adsManager.stop(),e.log("Cancelling oncue ad at "+o+" seconds"))},Z=function(e){return function(){var t=this.activeCues;if(!e.scrubbing()&&t&&t.length){var n=[t[t.length-1]];if(!z(e,this))return void this.removeEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler);e.ima3.cueState_.cueModule.processAdTrack(e,n,Y,X)}}},J=function(e,t){var n,a,o=t.cues;if(z(e,t)){if(o&&void 0!==o.length){for(var r=0;r<o.length;r++){var i=e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration();Math.abs(o[r].startTime-i)<=1?n=o[r]:0===o[r].startTime&&(a=o[r])}if(a||"media-cues"!==t.label){if(a){var d=e.ima3.cueState_.cueModule.getSupportedAdCue(e,a),s=e.ima3.cueState_.cueModule.getCueId(e,a),A=a.startTime,u=Math.abs(A-W(e));Q(e,d,s,A,u)}}else e.trigger("nopreroll");n||"media-cues"!==t.label||e.trigger("nopostroll")}t.addEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler)}},$=H={init:function(e,t){t.useMediaCuePoints||e.on("loadedmetadata",function(){H.liveCuePointHandler(e,e.ads.cueTextTracks)}),e.trigger("adsready"),e.on("contentchanged",function(){e.trigger("adsready")})},liveCuePointHandler:function(t,n){!function(e,t){e.ima3.cueState_={cueModule:t,adCueChangeHandler:Z(e),usedActiveCues:{},prerollHandledEarly:!1,prerollPlayed:!1,postrollHandled:!1,postrollPlayed:!1}}(t,n),t.ima3.cueState_.cueModule.setMetadataTrackMode=function(e){e.mode="hidden"},t.ima3.cueState_.cueModule.getCueId=function(e,t){var n=e.ima3.cueState_.cueModule.getSupportedAdCue(e,t);return n?n.id:null},t.ima3.cueState_.cueModule.isSupportedAdCue=function(e,t){return null!==e.ima3.cueState_.cueModule.getSupportedAdCue(e,t)},t.ima3.cueState_.cueModule.getSupportedAdCue=function(t,n){return"oncue"!==t.ima3.settings.requestMode||t.ima3.settings.useMediaCuePoints?null:function(t){var n;if(t&&!t.value||"TXXX"!==t.value.key)return null;try{n=JSON.parse(t.value.data)}catch(t){return e.log.error("ERROR: Parsing JSON. Please confirm that JSON is valid.",t.message),null}if(!n.name)return null;var a=n.name.toLowerCase();return"adcue"!==a&&"adcancel"!==a?null:n}(n)},t.ima3.cueState_.cueModule.processMetadataTracks(t,J)}};function K(e){if("string"==typeof e){var t=e.match(/^([\d]+)\.([\d]+)\.([\d]+)/);if(t)return[Number(t[1]),Number(t[2]),Number(t[3])]}}var ee,te=K("6.6.1");function ne(t){return e.getPlugin?e.getPlugin(t):e.getComponent("Player").prototype[t]}function ae(e){return{width:parseInt(ee.computedStyle(e.el(),"width"),10),height:parseInt(ee.computedStyle(e.el(),"height"),10)}}function oe(t){if(+t<0)return e.log.error("duration "+t+" can't be a negative number"),"00:00:00.000";if(+t>=86400)return e.log.error("duration "+t+" can't be over 24h"),"00:00:00.000";var n=1e3*t,a=parseInt(n%1e3,10),o=parseInt(n/1e3%60,10),r=parseInt(n/6e4%60,10),i=parseInt(n/36e5%24,10);return a<10?a="00"+a:a<100&&(a="0"+a),(i=i<10?"0"+i:i)+":"+(r=r<10?"0"+r:r)+":"+(o=o<10?"0"+o:o)+"."+a}function re(e){e.ima3.adsManager&&(e.ima3.adsManager.destroy(),e.ima3.adsManager=null),e.ima3.managerCleanup&&(e.ima3.managerCleanup(),e.ima3.managerCleanup=null)}function ie(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])}return e}var de=function(e){if(void 0!==e)return"application/javascript"===e.getContentType();throw new Error("Cannot check if the current ad is a VPAID when there is no ad.")},se=function(e){return!(!e||0!==e.getCuePoints().length)},Ae=ee={computedStyle:function(e,n){return"function"==typeof getComputedStyle?t.getComputedStyle(e)[n]:e.currentStyle[n]},getPlayerDimensions:ae,secondsToTime:oe,destroyAdsManager:re,extend:ie,loadScript:function(e,t){var a=n.createElement("script"),o=n.querySelector("head");a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(e,n){(n||!a.readyState||/loaded|complete/.test(a.readyState))&&(a.onload=a.onreadystatechange=null,a.parentNode.removeChild(a),a=null,t(n))},o.insertBefore(a,o.firstChild)},isEconomicsFree:function(e){return"object"==typeof e.mediainfo&&"FREE"===e.mediainfo.economics},isVpaid:de,isVast:se,isVmap:function(e){return!(!e||0===e.getCuePoints().length)},includesPreroll:function(e){return se(e)||e.getCuePoints().indexOf(0)>=0},includesPostroll:function(e){return e.getCuePoints().indexOf(-1)>=0},usingLiveAdCuepoints:function(e){return"oncue"===e.requestMode&&!e.useMediaCuePoints},usingMediaCuepoints:function(e){return"oncue"===e.requestMode&&e.useMediaCuePoints}},ue=["audioTrackButton","captionsButton","chaptersButton","descriptionsButton","subsCapsButton","subtitlesButton"],le=function(e){return[].concat(e).filter(function(e){return-1===ue.indexOf(e)})},ce=function(t,n){if(!("adControlBar"in n)){var a={name:"adControlBar"},o=t.getChild("controlBar");o&&o.getChild("volumeMenuButton")?a.volumeMenuButton={vertical:o.getChild("volumeMenuButton").options_.vertical}:o&&o.getChild("volumePanel")&&(a.volumePanel={inline:o.getChild("volumePanel").options_.inline}),n.adControlBar=ie({},t.options_.children.controlBar,a)}if(!n.adControlBar.hasOwnProperty("children")){var r=e.getComponent("ControlBar");n.adControlBar.children=le(r.prototype.options_.children)}n.showVpaidControls||t.addClass("vjs-vpaid-controls-disabled"),t.on("ima3-content-pause-requested",function(e){t.addClass("ima3-ad-loading"),t.trigger("ads-pod-started"),"application/javascript"===e.originalEvent.getAd().getContentType()&&t.addClass("vjs-vpaid-playing")}),t.on("ima3-complete",function(e){var n=t.$(".vjs-ad-control-bar .vjs-play-progress");n.className+=" vjs-play-progress-resetting",n.style.width="0"}),t.on("ima3-started",function(e){var n=t.$(".vjs-ad-control-bar .vjs-play-progress");n.className=n.className.replace(" vjs-play-progress-resetting","")})},pe=function(t,n){var a=new(e.getComponent("ControlBar"))(n,t.ima3.settings.adControlBar);a.addClass("vjs-ad-control-bar"),t.addClass("vjs-ad-controls"),t.addChild(a),t.ima3.adControlBar=a,!e.browser.IS_IOS&&!e.browser.IS_ANDROID||t.tech_.featuresVolumeControl||t.muted()||a.volumeMenuButton&&a.volumeMenuButton.addClass("vjs-hidden")},me=function(e){e.on("ads-ad-started",function(){e.ads.inAdBreak()&&!e.ads.videoElementRecycled()&&(e.ima3.volume=e.volume(),e.muted()?e.ima3.adPlayer.muted(!0):e.ima3.adPlayer.volume(e.volume()||e.ads.preAdVolume_)),e.ima3.adPlayer.trigger("durationchange")}),e.on(["ads-ad-ended","ads-ad-skipped"],function(){e.ads.inAdBreak()&&!e.ads.videoElementRecycled()&&(e.volume(e.ima3.adPlayer.volume()),e.ads.preAdVolume_&&(e.ads.preAdVolume_=e.volume()),e.muted(e.ima3.adPlayer.muted()))})},ge=function(n,a){var o=(e.ima3.AdPlayer=e.extend(e.getComponent("Component"),{constructor:function(){var t=[this].concat(Array.prototype.slice.call(arguments));e.getComponent("Component").apply(this,t)},buffered:function(){return[]},language:function(e){return void 0===e?this.options_.contentPlayer.language_:this.options_.contentPlayer.language(e)},languages:function(){return this.options_.contentPlayer.languages()},localize:function(e){return this.options_.contentPlayer.localize(e)},remainingTime:function(){return this.duration()-this.currentTime()},remainingTimeDisplay:function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},exitFullscreen:function(){return this.options_.contentPlayer.exitFullscreen()},reportUserActivity:function(){},requestFullscreen:function(){return this.options_.contentPlayer.requestFullscreen()},el:function(){return this.options_.contentPlayer.el()},audioTracks:function(){},textTracks:function(){},videoTracks:function(){},remoteTextTracks:function(){},addTextTrack:function(){},addRemoteTextTrack:function(){},removeRemoteTextTrack:function(){},scrubbing:function(){},lastVolume_:function(){var e;return(e=this.options_.contentPlayer).lastVolume_.apply(e,arguments)}}),e.ima3.Html5.adPlayer=function(n,a){var o=a.contentPlayer,r=new e.ima3.AdPlayer(a),i=!0;return r.currentTime=function(){var e=r.duration();if(!e||!o.ima3.adsManager)return 0;var t=o.ima3.adsManager.getRemainingTime();return t<=0?0:t>e?0:t>0?e-t:void 0},r.duration=function(){var e=o.ima3.currentAd;if(e){var t=e.getDuration();return t>0?t:0}return 0},r.pause=function(){i=!0,o.ima3.adsManager.pause()},r.paused=function(){return i},r.play=function(){i=!1,o.ima3.adsManager.resume(),r.trigger("play")},r.isFullscreen=function(){return o.isFullscreen()},r.requestFullscreen=function(){return o.requestFullscreen()},r.volume=function(t){if(o.ima3&&o.ima3.adsManager){var n=o.ima3.adsManager.getVolume();return void 0!==t&&(o.ima3.adsManager.setVolume(t),o.ima3.volume=t||o.ima3.volume,r.trigger("volumechange")),n||o.ima3.volume}e.log.error("Too early to set Volume. IMA3 is not loaded")},r.muted=function(e){var t=o.ima3.adsManager.getVolume();return void 0!==e?0===r.volume(e?0:o.ima3.volume):0===t},o.on("ima3-started",function(){o.removeClass("vjs-ima3-paused"),r.trigger("play"),i=!1}),o.on("ima3-resumed",function(){o.removeClass("vjs-ima3-paused"),r.trigger("play"),i=!1}),o.on("ima3-paused",function(){o.addClass("vjs-ima3-paused"),r.trigger("pause"),i=!0}),function e(){o.ads.isAdPlaying()&&!r.paused()&&r.trigger("timeupdate"),t.setTimeout(e,1e3)}(),r},e.ima3.Html5.adPlayer)(a,{contentPlayer:n});return n.ima3.adPlayer=o,o},fe="data:audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",he="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAC721kYXQhEAUgpBv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3pwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcCEQBSCkG//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADengAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAsJtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAB7HRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAALwAAAAAAAAAAAAAAAQEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAC8AAAAAAAEAAAAAAWRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAKxEAAAIAFXEAAAAAAAtaGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kSGFuZGxlcgAAAAEPbWluZgAAABBzbWhkAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAADTc3RibAAAAGdzdHNkAAAAAAAAAAEAAABXbXA0YQAAAAAAAAABAAAAAAAAAAAAAgAQAAAAAKxEAAAAAAAzZXNkcwAAAAADgICAIgACAASAgIAUQBUAAAAAAfQAAAHz+QWAgIACEhAGgICAAQIAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAIAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAFzAAABdAAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ni40MC4xMDE=";function ye(e){for(var t=e.match(/^data:([^;]+);base64,(.+)$/i),n=t[1],a=t[2],o=atob(a),r=o.length,i=Math.ceil(r/1024),d=new Array(i),s=0;s<i;++s){for(var A=1024*s,u=Math.min(A+1024,r),l=new Array(u-A),c=A,p=0;c<u;++p,++c)l[p]=o[c].charCodeAt(0);d[s]=new Uint8Array(l)}return new Blob(d,{type:n})}function ve(e){return Object.assign({muted:!1,timeout:250,inline:!1,blob:!1},e)}function Ce(e,t){var n=e.muted,a=e.timeout,o=e.inline,r=t(),i=r.element,d=r.source,s=void 0,A=void 0,u=void 0;return i.muted=n,!0===n&&i.setAttribute("muted","muted"),!0===o&&i.setAttribute("playsinline","playsinline"),i.src=d,new Promise(function(e){s=i.play(),A=setTimeout(function(){u(!1,new Error("Timeout "+a+" ms has been reached"))},a),u=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(A),e({result:t,error:n})},void 0!==s?s.then(function(){return u(!0)}).catch(function(e){return u(!1,e)}):u(!0)})}var _e={audio:function(e){return Ce(e=ve(e),function(){var t=e.blob?URL.createObjectURL(ye(he)):fe;return{element:document.createElement("audio"),source:t}})},video:function(e){return Ce(e=ve(e),function(){var t=e.blob?URL.createObjectURL(ye(he)):he;return{element:document.createElement("video"),source:t}})}},Me=function(e,t){return t.reduce(function(t,n){return t.then(function(){if(!e.ima3.canAutoPlayVideo&&!e.ima3.canAutoPlayInlineVideo)return function e(t,n){return _e[n.method](n.params).then(function(a){var o=a.result,r=a.error;if(t.ima3[n.prop]=o,r&&"Error"===r.name&&n.params.retryAfterTimeout&&(!t.ima3.canAutoPlayVideo||!t.ima3.canAutoPlayInlineVideo))return n.params.retryAfterTimeout--,e(t,n)})}(e,n)})},Promise.resolve()).then(function(){return Promise.resolve()})};function Pe(n){var a;return a=e.browser.IS_IOS&&n.playsinline()?[{prop:"canAutoPlayInlineVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!1,inline:!0}},{prop:"canAutoPlayMutedInlineVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!0,inline:!0}}]:[{prop:"canAutoPlayVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!1}},{prop:"canAutoPlayMutedVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!0}}],t.Promise?n.autoplay()?n.ima3.canAutoPlayTestsResult?n.ima3.canAutoPlayTestsResult:(n.ima3.canAutoPlayTestsResult=Me(n,a),n.ima3.canAutoPlayTestsResult):Promise.resolve():(n.ima3.canAutoPlayVideo=!0,n.ima3.canAutoPlayMutedVideo=!0,{then:function(e){e()}})}var be,Se=function(t){t.addClass("vjs-ima3-not-playing-yet"),t.ready(function(){Pe(t).then(function(){t.autoplay()&&!t.ima3.canAutoPlayVideo&&t.ima3.canAutoPlayMutedVideo&&(t.muted(!0),t.play()),e.browser.IS_IOS&&t.playsinline()&&t.autoplay()&&!t.ima3.canAutoPlayInlineVideo&&t.ima3.canAutoPlayMutedInlineVideo&&(t.muted(!0),t.play())})}),t.on(["playing"],function(e){t.removeClass("vjs-ima3-not-playing-yet")}),!t.autoplay()||e.browser.IS_IOS||e.browser.IS_ANDROID||t.addClass("vjs-ima3-autoplay")},Te=be={_addPlayerDimensions:function(t,n){(0,e.ima3.extend)(n,{linearAdSlotWidth:t.width,linearAdSlotHeight:t.height,nonLinearAdSlotWidth:t.width,nonLinearAdSlotHeight:t.height})},_addVmap:function(e,t,n){e.ima3.isReady_?t.adsResponse=n:e.ima3.oneUnlessContentUpdate_("ima3-ready",function(){t.adsResponse=n})},_adsRequest:function(e,n,a){var o=e.ima3.settings.requestMode,r=e.ima3.settings.useMediaCuePoints,i=t.google.ima;if(!i||i&&!i.AdsRequest)throw new Error("An ad request was made before the plugin is ready");var d=new i.AdsRequest;return be._addPlayerDimensions(Ae.getPlayerDimensions(e),d),"oncue"===o&&r&&a?be._addVmap(e,d,a):d.adTagUrl=n,e.ima3.adsRequest=d,Pe(e).then(function(){d.setAdWillPlayMuted(e.muted()),d.setAdWillAutoPlay(e.autoplay()),e.ima3.adsLoader.requestAds(d),e.trigger("ads-request")})},_handleEconomicsFree:function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},_isRepeatForSourceAllowed:function(e){var t=e.ima3.settings.requestMode;return"onload"!==t&&"onplay"!==t},_isRepeatForSource:function(e){return e.ima3.lastSrc_===e.currentSrc()},_handleMissingAdTagUrl:function(e){e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")},_afterServerUrlFunctionCheck:function(e,t,n){var a,o=e.ima3.settings.requestMode;null!=t&&(a=e.ima3.adMacroReplacement(t)),"oncue"===o||a?be._adsRequest(e,a,n):be._handleMissingAdTagUrl(e)},_handleServerUrlFunctionResponse:function(e,t){Ae.isEconomicsFree(e)?be._handleEconomicsFree(e):be._afterServerUrlFunctionCheck(e,t)},_afterPlay:function(e,t,n){var a=e.ima3.settings.useMediaCuePoints;Ae.isEconomicsFree(e)?be._handleEconomicsFree(e):(a||(t=t||e.ima3.settings.serverUrl),a||"function"!=typeof t?be._afterServerUrlFunctionCheck(e,t,n):t(function(t){be._handleServerUrlFunctionResponse(e,t)}))},_shouldWaitUntilPlay:function(e){var t=e.ima3.settings.requestMode,n=e.ima3.settings.useMediaCuePoints;return("onplay"===t||"oncue"===t&&n)&&!e.ima3._playSeen&&e.paused()&&!e.ads._pausedOnContentupdate},_waitUntilPlay:function(e,t,n){Ae.isEconomicsFree(e)?be._handleEconomicsFree(e):(e.ima3._requestAdsOnPlay=function(){be._afterPlay(e,t,n)},e.one("play",e.ima3._requestAdsOnPlay))},requestAds:function(t,n,a){!be._isRepeatForSource(t)||be._isRepeatForSourceAllowed(t)?be._shouldWaitUntilPlay(t)?be._waitUntilPlay(t,n,a):be._afterPlay(t,n,a):e.log("Cancelling repeat adsRequest for "+t.currentSrc())}},ke=function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},we=function(t,n){n.ima3.isReady_?n.mediainfo&&"FREE"===n.mediainfo.economics?e.log("On demand adRequest attempted on video with advertising disabled."):t?(e.log("Clearing any previous VAST ad data and triggering ondemand adrequest."),n.ads.startLinearAdMode(),re(n),Te.requestAds(n,t),n.addClass("ima3-ad-loading")):e.log("On demand adRequest attempted without an adTagUrl!"):e.log.error("Cannot make an ad request when the plugin is not ready. Skipping ad...")},Re={0:"PREROLL","-1":"POSTROLL"},qe=function(e,t,n){""!==n&&(e.currentAdEventInfo[t]?e.currentAdEventInfo[t].push(n):e.currentAdEventInfo[t]=[n])},Ee=function(e,t){void 0!==e.ima3.currentAd&&(e.ads.ad.id=e.ima3.currentAd.getAdId(),e.ads.ad.duration=e.ima3.currentAd.getDuration(),e.ads.ad.currentTime=e.ima3.currentAd.getDuration()-e.ima3.adsManager.getRemainingTime(),e.ads.ad.timeOffset=e.ima3.currentAd.getAdPodInfo().getTimeOffset(),e.ads.ad.index=e.ima3.currentAd.getAdPodInfo().getAdPosition()-1,e.ads.ad.type=Re[e.ima3.currentAd.getAdPodInfo().getTimeOffset()]||"MIDROLL",e.ads.pod.id=e.ima3.currentAd.getAdPodInfo().getPodIndex(),e.ads.pod.size=e.ima3.currentAd.getAdPodInfo().getTotalAds(),"ima3-started"===t&&(!function(e,t){if(void 0!==t){var n=e.ima3;n.currentAdEventInfo.adPodId=e.ads.pod.id,n.currentAdEventInfo.adPodLength=e.ads.pod.size,n.currentAdEventInfo.adType=e.ads.adType,qe(n,"adId",e.ads.ad.id),qe(n,"creativeLength",e.ads.ad.duration),qe(n,"creativeIndex",e.ads.ad.index),qe(n,"creativeId",t.getCreativeId()),qe(n,"creativeAdId",t.getCreativeAdId()),qe(n,"creativeFormat",t.getContentType()),qe(n,"creativeUrl",t.getMediaUrl()),qe(n,"surveyUrl",t.getSurveyUrl()),qe(n,"adTitle",t.getTitle()),qe(n,"wrapperCreativeIds",t.getWrapperCreativeIds()),qe(n,"advertiserName",t.getAdvertiserName()),qe(n,"dealId",t.getDealId()),qe(n,"adSystem",t.getAdSystem()),qe(n,"wrapperAdSystems",t.getWrapperAdSystems())}}(e,e.ima3.currentAd),qe(e.ima3,"started",e.ads.ad.index))),"ima3-complete"===t&&qe(e.ima3,"completed",e.ads.ad.index)},Ie=function(e,t,n){var a={},o=t||"";if(e.bcinfo&&(a["{player.url}"]=e.bcinfo.scriptUrl),n&&n.metadata&&-1!==t.indexOf("{mediainfo.ad_keys}")){var r=encodeURIComponent(n.metadata);o=t.replace("{mediainfo.ad_keys}",r)}return e.ads.adMacroReplacement(o,!0,a)};function Le(e){var t=e.mediainfo,n=e.ima3.settings.serverUrl;if(t&&"AD_SUPPORTED"===t.economics&&t.cuePoints.length>0){for(var a='<vmap:VMAP xmlns:vmap="http://www.iab.net/videosuite/vmap" version="1.0">\n',o=!1,r=0;r<t.cuePoints.length;r++)if("AD"===t.cuePoints[r].type){o=!0,t.cuePoints[r].time<1?a+='<vmap:AdBreak timeOffset="start" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n':t.duration-t.cuePoints[r].time<1?a+='<vmap:AdBreak timeOffset="end" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n':a+='<vmap:AdBreak timeOffset="'+oe(t.cuePoints[r].time)+'" breakType="linear" breakId="'+t.cuePoints[r].name+'">\n';var i=Ie(e,n,t.cuePoints[r]);a+=' <vmap:AdSource id="'+t.cuePoints[r].id+'" allowMultipleAds="true" followRedirects="true">\n<vmap:AdTagURI templateType="vast3">\n<![CDATA['+i+"]]>\n</vmap:AdTagURI>\n</vmap:AdSource>\n</vmap:AdBreak>\n"}return a+="</vmap:VMAP>",o||(a=null),a}}var Be={"ima3-click":"ads-click","ima3-started":"ads-ad-started","ima3-complete":"ads-ad-ended","ima3-first-quartile":"ads-first-quartile","ima3-midpoint":"ads-midpoint","ima3-third-quartile":"ads-third-quartile","ima3-volume-changed":"ads-volumechange","ima3-paused":"ads-pause","ima3-resumed":"ads-play","ima3-skipped":"ads-ad-skipped","ima3-all-ads-completed":"ads-allpods-completed","ads-request":"ads-request","ads-pod-ended":"ads-pod-ended","ads-pod-started":"ads-pod-started","ads-load":"ads-load"},je=function(e,t,n,a){var o=function(n){e.trigger({type:a,emitter:t,originalEvent:n}),Ee(e,a);var o=Be[a];if(o){var r={type:o};"ads-ad-started"!==o&&"ads-ad-ended"!==o||(r.indexInBreak=e.ads.ad.index),e.trigger(r)}};return t.addEventListener(n,o,!1),o},Oe=function(e,t,n){var a={},o=t.ima3._eventMapping.eventTypes;for(var r in void 0===n&&(n=je),o)a[r]=n(t,e,r,o[r]);return function(){for(var t in a)e.removeEventListener(t,a[t])}},Ne=function(e){return"ima3-"+e.toLowerCase().replace(/_/g,"-")},Ue=function(e){for(var t=e.textTracks(),n=0;n<t.length;n++)"metadata"===t[n].kind&&"disabled"===t[n].mode&&(t[n].mode="hidden")},xe=function(n){n.on("fullscreenchange",function(a){var o=t.google.ima;e.IS_ANY_SAFARI&&Ue(n);var r=n.hasClass("vjs-fullscreen");if(n.ima3&&n.ima3.adsManager){var i=r?o.ViewMode.FULLSCREEN:o.ViewMode.NORMAL,d=ae(n);i===o.ViewMode.FULLSCREEN?n.ima3.adsManager.resize(n.el().offsetWidth,n.el().offsetHeight,i):n.ima3.adsManager.resize(d.width,d.height,i),setTimeout(function e(t,n,a,o,r,i){var d=ae(t);return function(){n===a.ViewMode.FULLSCREEN?t.ima3.adsManager.resize(t.el().offsetWidth,t.el().offsetHeight,n):t.ima3.adsManager.resize(d.width,d.height,n),d.width===r&&d.height===i||o>=0&&setTimeout(e(t,n,a,o-1,d.width,d.height),1e3)}}(n,i,o,3,d.width,d.height),1e3)}}),n.on("resize",function(){if(n.ima3.adsManager){var e=ae(n);n.ima3.adsManager.resize(e.width,e.height,t.google.ima.ViewMode.NORMAL)}})},Ve=function(e,t){var n=e.AdError.ErrorCode;for(var a in n)if(n.hasOwnProperty(a)&&!a.match("COMPANION|NONLINEAR|OVERLAY")&&t.getErrorCode()===n[a]&&"adLoadError"===t.getType())return!0;return!1},De=function(t){var n=t.ima3.adsManager;Ae.isVast(n)?(Ae.destroyAdsManager(t),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout")):Ae.isVmap(n)&&Ae.includesPreroll(n)&&(t.ima3.adsManager.discardAdBreak(),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout"))},Fe=function(e){e.ima3.adDisplayContainer&&!e.ima3.adDisplayContainer.initialized&&(e.ima3.adDisplayContainer.initialize(),e.ima3.adDisplayContainer.initialized=!0)},He=function(n){var a=t.google.ima,o=Ae.getPlayerDimensions(n);try{n.muted()?n.ima3.adsManager.setVolume(0):n.ima3.adsManager.setVolume(.01),Fe(n),n.trigger("ads-load"),n.ima3.adsManager.init(o.width,o.height,a.ViewMode.NORMAL),n.ima3.adsManager.start()}catch(t){e.log.warn("Error starting ads manager",t),n.trigger("adserror")}},ze=function(e){e.ima3.adsManager.discardAdBreak(),e.ima3.adsManager.skip(),e.ima3.managerCleanup=null,e.ads.inAdBreak()&&e.ads.endLinearAdMode()},Ge=function(t,n){if(n.ima3SdkSettings)for(var a in n.ima3SdkSettings){var o="set"+a.charAt(0).toUpperCase()+a.slice(1);"function"==typeof t.settings[o]?t.settings[o](n.ima3SdkSettings[a]):e.log.warn('Invalid ima3SdkSetting: "'+a+'"')}},Qe=function(n,a,o){var r=t.google.ima,i={};!function(e){e._eventMapping={},e.settings.eventMap=Be;for(var n=t.google.ima,a={},o=["AdErrorEvent","AdEvent","AdsManagerLoadedEvent"],r=o.length;r--;)if(n[o[r]]&&n[o[r]].Type){var i=n[o[r]].Type;for(var d in i)i.hasOwnProperty(d)&&(a[i[d]]=Ne(d))}e._eventMapping.eventTypes=a}(n.ima3),Ge(r,a);var d=ge(n,o);if(pe(n,d),a.vpaidMode){if("number"!=typeof r.ImaSdkSettings.VpaidMode[a.vpaidMode])throw new Error('Invalid VPAID Mode: "'+a.vpaidMode+'"');r.settings.setVpaidMode(r.ImaSdkSettings.VpaidMode[a.vpaidMode])}var s=n.el().querySelector(".vjs-tech");n.ima3.adDisplayContainer=new r.AdDisplayContainer(o,s,a.clickTrackingElement),n.ima3.adDisplayContainer.initialized=!1;var A="click";(e.browser.IS_IOS||e.browser.IS_ANDROID)&&(A="touchend"),n.one(A,function(){Fe(n)}),n.ima3.adsLoader=new r.AdsLoader(n.ima3.adDisplayContainer);var u=n.ima3.adsLoader.getSettings();u.setPlayerVersion(n.ima3.version),u.setPlayerType("brightcove/player-html5"),n.ima3.loaderCleanup=Oe(n.ima3.adsLoader,n);var l=n.currentSrc();Ae.usingMediaCuepoints(a)&&function(t,n,a){t.ima3._loadstartSeen&&t.ima3.settings.serverUrl&&t.mediainfo?a.vmap=Le(t):t.ima3.oneUnlessContentUpdate_("loadstart",function(){setTimeout(function(){t.ima3.settings.serverUrl?a.vmap=Le(t):e.log.error("ima3 serverUrl isnt provided")},0)})}(n,0,i),function(e,t,n){if("ondemand"!==t.requestMode&&!Ae.usingLiveAdCuepoints(t)){var a=function(){e.mediainfo&&"FREE"===e.mediainfo.economics?(e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")):Te.requestAds(e,null,n.vmap)};e.ima3._loadstartSeen?a():e.one("loadstart",function(){setTimeout(function(){a()},0)})}}(n,a,i),n.ima3.currentSrc_=n.currentSrc(),n.on("dispose",function(){Ae.destroyAdsManager(n),e._ima3sawDispose=!0}),n.on("contentchanged",function(){!function(e,t,n,a){setTimeout(function(){if(n=e.currentSrc(),Ae.destroyAdsManager(e),e.ima3._checkedForAdManagerStart=!1,e.ima3.lastSrc_=e.ima3.currentSrc_,e.ima3.currentSrc_=e.currentSrc(),Ae.isEconomicsFree(e))return e.trigger("adscanceled"),e.trigger("nopreroll"),void e.trigger("nopostroll");"ondemand"!==t.requestMode?n&&""!==n&&"ondemand"!==t.requestMode&&!Ae.usingLiveAdCuepoints(t)&&Te.requestAds(e,null,a):ke(e)},0)}(n,a,l,i.vmap)});var c=function(){!function(t){t.ima3&&t.ima3.adsManager&&t.ima3.adsManager.skip&&t.ima3.adsManager.skip(),Ae.destroyAdsManager(t),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout")}(n)};n.on("contentended",function(){n.one("adtimeout",c),n.ima3.adsLoader.contentComplete()}),n.on(["contentupdate","dispose"],function(){n.off("adtimeout",c)}),n.on(["contentupdate","adend","ima3-ready"],function(){n.ads.ad={},n.ads.pod={}}),n.ima3.el=o},We=function(e){var t=e.ima3.adsManager.getCuePoints(),n=t&&t.length>0,a=!(!e.ima3.adsRequest||!e.ima3.adsRequest.adsResponse);return Ae.usingMediaCuepoints(e.ima3.settings)&&n&&!a},Ye=function(t,n){"ondemand"===n.requestMode||Ae.usingLiveAdCuepoints(n)||t.ads.startLinearAdMode(),e._ima3sawDispose&&!e._ima3adAfterDispose&&(t.trigger({type:"usage",name:"ima3-ad-after-dispose"}),e._ima3adAfterDispose=!0)},Xe=function(e){e.ads.inAdBreak()?(e.ads.endLinearAdMode(),e.removeClass("ima3-ad-loading"),e.removeClass("vjs-vpaid-playing"),e.trigger("ads-pod-ended")):e.ads.skipLinearAdMode()},Ze=function(e){var t="Non-fatal error occurred";if(e){var n=e.getErrorCode(),a=e.getMessage();n&&(t+=": AdError "+n),a&&(t+=": "+a)}return t},Je=function(e){e.on("adstart",function(t){e.ads.shouldPlayContentBehindAd(e)||e.pause(),e.hasStarted(!0),e.ima3.currentAdEventInfo={},"oncue"!==e.ima3.settings.requestmode&&e.duration()===1/0&&e.trigger({type:"usage",name:"ima3-live-preroll"})}),e.on("adend",function(){e.duration()===1/0&&e.trigger("playing")}),e.on("adplay",function(){e.tech_.src()!==e.ads.snapshot.src||e.currentSrc()!==e.ads.snapshot.currentSrc||setTimeout(function(){e.pause()},0)})},$e=function(a,o){var r=n.createElement("div");r.className="vjs-ima3-ad-container",a.ima3.insertAdContainer(r),a.ima3.adrequest=function(e){we(e||o.serverUrl,a)},a.on("ima3-content-pause-requested",function(e){Ye(a,o)}),a.on("ima3-content-resume-requested",function(e){Xe(a)}),xe(a),a.on("ima3-started",function(t){a.removeClass("ima3-ad-loading"),e.log("ima3-started"),a.ima3.currentAd=t.originalEvent.getAd()}),a.on("ima3-log",function(t){var n=t.originalEvent.getAdData().adError;e.log("ima3-log:",Ze(n))}),a.on("ima3-ad-error",function(n){var o,r={};n.originalEvent&&(o=(r=n.originalEvent.getError()).getErrorCode(),e.log("ima3-ad-error",r.toString()),(Ve(t.google.ima,r)&&"onload"===a.ima3.settings.requestMode||"onplay"===a.ima3.settings.requestMode)&&a.trigger("nopostroll")),a.removeClass("ima3-ad-loading"),a.trigger({type:"adserror",errorCode:o})}),o.hardTimeouts&&a.on("adtimeout",function(){if(a.ima3.adsManager)De(a);else{var e=function(){De(a)};a.one("ima3-ads-manager-loaded",e),a.one(["adstart","contentupdate","dispose"],function(t){a.off("ima3-ads-manager-loaded",e)})}}),a.on("ima3-loaded",function(e){var t=e.originalEvent.getAd();a.trigger("ads-loading"),a.removeClass("ima3-ad-loading"),t&&!t.isLinear()&&(a.addClass("vjs-ima3-overlay"),a.ads.startLinearAdMode(),a.ads.endLinearAdMode())}),a.on("ima3-complete",function(t){var n=t.originalEvent.getAd();e.log("ima3-complete"),delete a.ima3.currentAd,n&&(n.isLinear()?a.addClass("ima3-ad-loading"):a.removeClass("vjs-ima3-overlay"))}),a.on(["readyforpreroll","playing"],function(){a.ima3._checkedForAdManagerStart||(a.ima3._checkedForAdManagerStart=!0,!a.ima3.adsManager||Ae.usingLiveAdCuepoints(o)||"ondemand"===o.requestMode||Ae.isEconomicsFree(a)||He(a))}),a.on("adserror",function(){Ae.destroyAdsManager(a)}),a.on("adscanceled",function(){Ae.destroyAdsManager(a)}),a.on("ima3-ads-manager-loaded",function(t){!function(t,n){t.ima3.managerCleanup&&Ae.destroyAdsManager(t);var a={currentTime:t.currentTime(),duration:t.duration()};t.on("timeupdate",function(){a.currentTime=t.currentTime()});var o=n.originalEvent.getAdsManager(a,t.ima3.adsRenderingSettings_);t.ima3.adsManager=o,t.trigger("ads-response-received");var r=t.ima3.settings;if(We(t))return ze(t),void e.log.error("Cancelling VMAP ad because thead server cannot return a vmap when using cuepoints");t.ima3.managerCleanup=Oe(o,t),"ondemand"===r.requestMode||"oncue"===r.requestMode?He(t):t.trigger("adsready"),"oncue"!==r.requestMode&&(Ae.includesPreroll(o)||t.trigger("nopreroll"),Ae.includesPostroll(o)||t.trigger("nopostroll"))}(a,t)}),e.use&&!e._imaMiddlewareSetup&&(e.log("Setting up IMA middleware"),e.use("*",function(e){return{setSource:function(t,n){if(e.ads.inAdBreak()){e.ima3.adsManager.discardAdBreak(),e.ads.disableNextSnapshotRestore=!0,e.ads.endLinearAdMode(),e.trigger("contentresumed");var a=e.play();a&&a.catch&&a.catch(function(){})}n(null,t)}}}),e._imaMiddlewareSetup=!0),t.google&&t.google.ima?(Qe(a,o,r),a.trigger("ima3-ready")):Ae.loadScript(o.sdkurl,function(e){Qe(a,o,r),e?a.trigger({type:"adserror",info:e}):a.trigger("ima3-ready")})},Ke={sdkurl:(/^(file|data):/.test(t.location.protocol)?"http:":"")+"//imasdk.googleapis.com/js/sdkloader/ima3.js",adTechOrder:["html5"],serverUrl:("file:"===t.location.protocol?"http:":"")+"//pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=%2F6062%2Fiab_vast_samples&ciu_szs=300x250%2C728x90&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&cust_params=iab_vast_samples%3Dlinear",timeout:4e3,requestMode:"onload",hardTimeouts:!0,showVpaidControls:!1};e.ima3={extend:ie};var et=function(t){var n=this,a=function(t,n){var a=ie({},Ke,n||{});if(t.ima3.defaults=Ke,n&&n.useMediaCuePoints&&"oncue"!==n.requestMode)throw new Error('useMediaCuePoints must be used with requestMode "oncue" rather than the currently set '+n.requestMode);return"onplay"===a.requestMode&&t.autoplay()&&(a.requestMode="onload"),a.prerollTimeout&&(e.log.warn("The prerollTimeout option is deprecated and will be removed, please use the timeout option. The prerollTimeout will be set to the value of the timeout option."),a.prerollTimeout=void 0),a.postrollTimeout&&(e.log.warn("The postrollTimeout option is deprecated and will be removed, please use the timeout option. The postrollTimeout will be set to the value of the timeout option."),a.postrollTimeout=void 0),a.timeout&&(a.prerollTimeout=a.postrollTimeout=a.timeout),a.contribAdsPrerollTimeout&&(a.prerollTimeout=a.contribAdsPrerollTimeout),a.contribAdsPostrollTimeout&&(a.postrollTimeout=a.contribAdsPostrollTimeout),a.debug=a.debugContribAds,a.liveCuePoints="oncue"===a.requestMode,a}(this,t);Se(this),ce(this,a,ie),me(this),this.on(["dispose","contentchanged"],function(){var e;(e=n).ima3._loadstartSeen=!1,e.ima3._playSeen=!1,void 0!==e.ima3._requestAdsOnPlay&&e.off("play",e.ima3._requestAdsOnPlay)}),this.on("loadstart",function(){n.ima3._loadstartSeen=!0}),this.on("play",function(){n.ima3._playSeen=!0}),this.ads(a),this.ads.ad={},this.ads.pod={id:void 0,size:void 0},this.contribAds6Shim(e.mergeOptions({},a.contribAds6Shim||{})),"oncue"===a.requestMode?$.init(this,a):"ondemand"===a.requestMode&&ke(this),this.ima3=function(e,t){var n=e.el().querySelector(".vjs-tech"),a={readyQueue_:[],isReady_:!1,player:e,tech:n,adTech:"html5",settings:t,ready:function(t){return t&&(e.ima3.isReady_?t.call(e):(void 0===e.ima3.readyQueue_&&(e.ima3.readyQueue_=[]),e.ima3.readyQueue_.push(t))),e.ima3},adMacroReplacement:function(t){return Ie(e,t)},insertAdContainer:function(t){!function(e,t){var n=e.el().querySelector(".vjs-big-play-button");e.el().insertBefore(t,n)}(e,t)},currentAdEventInfo:{},addToCurrentAdEventInfo:function(t,n){qe(e,t,n)},setAdsRenderingSettings:function(t){!function(e,t){e.ima3.adsRenderingSettings_=t,e.ima3.adsManager&&e.ima3.adsManager.updateAdsRenderingSettings(t)}(e,t)},oneHandlers_:[],oneUnlessContentUpdate_:function(t,n){!function(e,t,n){e.ima3.oneHandlers_.push({type:t,handler:n}),e.one(t,n)}(e,t,n)},isVpaid:function(){return de(e.ima3.currentAd)},version:"3.2.4",VERSION:"3.2.4"};return e.on("contentupdate",function(){for(var t=e.ima3.oneHandlers_,n=0;n<t.length;n++){var a=t[n];e.off(a.type,a.handler)}e.ima3.oneHandlers_=[]}),e.on("ima3-ready",function(){e.ima3.isReady_=!0;for(var t=0;t<e.ima3.readyQueue_.length;t++)e.ima3.readyQueue_[t].call(e);e.ima3.readyQueue_=[]}),a}(this,a),Je(this),this.ready(function(){var t=e.getTech("Html5");if(!t||!t.isSupported())throw new Error("Html5 is not available on this platform.");e.ima3.Html5=$e,$e(n,a),n.addClass("vjs-ima3-html5")},!0)};et.version="3.2.4",et.VERSION="3.2.4",function(t){if(ne("ima3"))return!1;var n,a,o,r,i=ne("ads");n=i.VERSION,o=K(n),(!(r=a?K(a):te)||!o||o[0]!==r[0]||o[1]<r[1]||!(o[1]>r[1]||o[2]>=r[2]))&&e.log.error('The IMA plugin depends on contrib-ads version "'+te+'", but it saw version "'+i.VERSION+'". This is not a compatible configuration. The IMA plugin will attempt to continue initializing, but this problem should be addressed. If you are using ad failover, please select compatible versions of the SSAI and IMA plugins.'),(e.registerPlugin||e.plugin)("ima3",t)}(et)});
